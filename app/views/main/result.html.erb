<% content_for :title, "Results" %>

<div id="source_content">
  <h3>Content</h3>
  <% if @result.source_format == 'plain_text' -%>
  <%= simple_format formatted_content(@result) %>
  <% else -%>
  <%= formatted_content(@result) %>
  <% end -%>
  <% unless @result.source_url.blank? -%>
  <p><%= link_to "View Original", @result.source_url %></p>
  <% end -%>
</div>
<div id="sidebar">

  <div id="copy_link">
    <h3>Copy Link</h3>
    <%= text_field_tag 'url', result_url(@result.slug), :id => 'share_url', :readonly => 'readonly', :size => 30 %>
  </div>
  
  <div id="status">
    <h3>Status</h3>
    <p><em><%= @result.status %></em></p>
  </div>
  
  <% if @result.entities.nil? || @result.entities.empty? || @result.contribution_count == 0 -%>
  <div id="contribution_report" style="display:none;">
  <% else -%>
  <div id="contribution_report">
  <% end -%>
    <h3>Contribution Report</h3>
    <ul>
    <% @result.entities.each do |recipient| -%>
      <% if recipient.contributors -%>
      <% recipient.contributors.each do |contributor| -%>
      <li><%= link_to contributor.name, influence_explorer_url(contributor) %> has donated $<%= number_with_delimiter contributor.amount %> to <%= link_to recipient.name, influence_explorer_url(recipient) %></li>
      <% end -%>
      <% end -%>
    <% end -%>
    </ul>
  </div>
  
  <% if @result.entities.nil? || @result.entities.empty? -%>
  <div id="extracted_entities" style="display:none;">
  <% else -%>
  <div id="extracted_entities">  
  <% end -%>
    <h3>Extracted Entities</h3>
    <table>
      <tr>
        <th>Type</th>
        <th>Name</th>
      </tr>
      <% @result.entities.each do |entity| -%>
      <tr>
        <td><%= entity.entity_type %></td>
        <% if entity.tdata_id.blank? -%>
        <td><%= entity.name %></td>
        <% else -%>
        <td><%= link_to entity.name, influence_explorer_url(entity) %></td>
        <% end -%>
      </tr>
      <% end -%>
    </table>
  </div>
</div>

<script type="text/javascript" charset="utf-8">
  var slug = '<%= @result.slug %>';
  var entityCount = <%= @result.entities.length %>;
  var resultStatus = '<%= @result.status %>';
</script>